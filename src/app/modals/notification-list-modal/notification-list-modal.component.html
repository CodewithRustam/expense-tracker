<ion-header class="ion-no-border">
  <ion-toolbar>
    <ion-title class="modal-title">Notifications</ion-title>
    <ion-buttons slot="end">
      <ion-button (click)="close()" class="close-btn" color="tertiary">
        <ion-icon name="close-circle"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <div class="main-container">

    <!-- Loading -->
    <div class="list-wrapper" *ngIf="loading">
      <ion-skeleton-text animated style="width: 100%; height: 100px; border-radius: 18px; margin-bottom: 10px;"
        *ngFor="let i of [1,2,3]">
      </ion-skeleton-text>
    </div>

    <!-- List -->
    <ng-container *ngIf="!loading">
      <div class="list-wrapper" *ngIf="notifications.length > 0; else emptyView">

        <ion-list class="bg-transparent" lines="none">
          <ion-item-sliding #slidingItem *ngFor="let n of notifications; trackBy: trackById"
            (ionDrag)="onDrag($event, n)" (ionSwipe)="onSwipeDelete(n, slidingItem)" (ionItemDidClose)="resetColor(n)">

            <ion-item class="notification-item" [class.unread]="!n.isRead" [class.collapsing]="n.collapsing">

              <div class="notification-card-inner" [style.background]="n.swipeColor || null">

                <div class="notif-header">
                  <h2>{{ n.title }}</h2>
                  <div *ngIf="!n.isRead" class="unread-dot"></div>
                </div>

                <p class="notif-body">
                  {{ cleanBody(n.body) }}
                </p>

                <div class="notif-footer">
                  <span class="category-tag">
                    {{ n.type || 'Expense' }}
                  </span>
                  <span class="time-stamp">
                    {{ formatTimestamp(n.sentAt) }}
                  </span>
                </div>

              </div>

            </ion-item>

            <ion-item-options side="end">
              <ion-item-option expandable>
              </ion-item-option>
            </ion-item-options>

          </ion-item-sliding>


        </ion-list>

        <div class="clear-all-row">
          <ion-button fill="clear" color="tertiary" (click)="clearAll()" [disabled]="isClearing">
            Clear all
          </ion-button>
        </div>

      </div>
    </ng-container>

    <!-- Empty -->
    <ng-template #emptyView>
      <div class="empty-state">
        <ion-icon name="notifications-off-outline"></ion-icon>
        <p>No new notifications</p>
      </div>
    </ng-template>

  </div>
</ion-content>