<!-- reset-password.page.html -->
<ion-content class="ion-padding reset-page" fullscreen>
  <div class="status-header"></div>

  <div class="reset-container">

    <!-- 1. Loading spinner while verifying -->
    <ng-container *ngIf="checkingToken">
      <ion-spinner name="crescent" class="center-spinner"></ion-spinner>
      <p class="center-text">Verifying reset link…</p>
    </ng-container>

    <!-- 2. Link expired / invalid -->
    <ng-container *ngIf="!checkingToken && !tokenValid" class="forget-container">
      <div class="logo-section">
        <img src="/assets/donut-chart.png" alt="SplitX Logo" class="logo-icon" />
        <h2 class="welcome-text">SplitX</h2>
      </div>

      <ion-card class="auth-card">
        <ion-card-content class="ion-text-center">
          <ion-icon name="alert-circle-outline" color="danger" size="large"></ion-icon>
          <h2>Link Expired or Invalid</h2>
          <p style="margin-top: 10px;">
            The password-reset link you used is no longer valid.
          </p>
          <p style="margin-top: 10px;"> Please request a new one.</p>
          <ion-button class="request-btn" expand="block" routerLink="/forgot-password">
            Request New Link
          </ion-button>
        </ion-card-content>
      </ion-card>
    </ng-container>

    <!-- 3. Valid token → show the original form -->
    <ng-container *ngIf="!checkingToken && tokenValid">
      <div class="logo-section">
        <img src="/assets/donut-chart.png" alt="SplitX Logo" class="logo-icon" />
        <h2 class="welcome-text">SplitX</h2>
        <p class="sub-text">Enter your new password</p>
      </div>

      <ion-card class="auth-card">
        <ion-card-content>
          <form #resetForm="ngForm" (ngSubmit)="resetPassword()">

            <!-- New Password -->
            <ion-item class="input-item" lines="none" [class.ion-focused]="focusedField === 'password'">
              <ion-icon name="lock-closed-outline" slot="start"></ion-icon>
              <ion-input type="password" placeholder="New Password" [(ngModel)]="password" name="password"
                #passwordInput="ngModel" required minlength="6" (ionFocus)="focusedField='password'"
                (ionBlur)="focusedField=''">
              </ion-input>
            </ion-item>
            <div class="input-error" *ngIf="password && password.length < 6">
              Password must be at least 6 characters.
            </div>

            <!-- Confirm Password -->
            <ion-item class="input-item" lines="none" [class.ion-focused]="focusedField === 'confirmPassword'">
              <ion-icon name="lock-closed-outline" slot="start"></ion-icon>
              <ion-input type="password" placeholder="Confirm Password" [(ngModel)]="confirmPassword"
                name="confirmPassword" #confirmPasswordInput="ngModel" required
                (ionFocus)="focusedField='confirmPassword'" (ionBlur)="focusedField=''">
              </ion-input>
            </ion-item>
            <div class="input-error" *ngIf="confirmPassword && password !== confirmPassword">
              Passwords do not match.
            </div>

            <!-- Submit -->
            <ion-button type="submit" expand="block" class="reset-btn"
              [disabled]="!resetForm.valid || password !== confirmPassword || password.length < 6">
              Reset Password
            </ion-button>
          </form>
        </ion-card-content>
      </ion-card>
    </ng-container>

  </div>
</ion-content>